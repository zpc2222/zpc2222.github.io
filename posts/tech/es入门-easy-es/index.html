<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Es入门-easy-es | 我的个人小站</title><meta name=keywords content="IO,网络编程"><meta name=description content="ElasticSearch入门使用"><meta name=author content="
作者:&nbsp;藏锋"><link rel=canonical href=https://zpc2222.github.io/posts/tech/es%E5%85%A5%E9%97%A8-easy-es/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://zpc2222.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://zpc2222.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://zpc2222.github.io/img/Q.gif><link rel=apple-touch-icon href=https://zpc2222.github.io/img/Q.gif><link rel=mask-icon href=https://zpc2222.github.io/img/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="Es入门-easy-es"><meta property="og:description" content="ElasticSearch入门使用"><meta property="og:type" content="article"><meta property="og:url" content="https://zpc2222.github.io/posts/tech/es%E5%85%A5%E9%97%A8-easy-es/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-29T00:00:00+08:00"><meta property="article:modified_time" content="2022-11-29T00:00:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Es入门-easy-es"><meta name=twitter:description content="ElasticSearch入门使用"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"📚文章","item":"https://zpc2222.github.io/posts/"},{"@type":"ListItem","position":3,"name":"👨🏻‍💻 技术","item":"https://zpc2222.github.io/posts/tech/"},{"@type":"ListItem","position":4,"name":"Es入门-easy-es","item":"https://zpc2222.github.io/posts/tech/es%E5%85%A5%E9%97%A8-easy-es/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Es入门-easy-es","name":"Es入门-easy-es","description":"ElasticSearch入门使用","keywords":["IO","网络编程"],"articleBody":"简介 官网地址：\u003e https://www.easy-es.cn\n选择理由：省心，省力，省代码。简单好用，少操心\n引用 pom依赖 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 cn.easy-es easy-es-boot-starter 1.1.0 org.elasticsearch.client elasticsearch-rest-high-level-client 7.14.0 org.elasticsearch elasticsearch 7.14.0 配置 如果是properties，也差距不大\n1 2 3 4 5 6 7 8 9 10 easy-es: # 是否开启EE自动配置,若为false时,则认为不启用本框架 enable: true # ES连接地址+端口 address: 127.0.0.1:9200 # 关闭自带banner banner: false schema: http username: elastic #有设置才填写,非必须 password: elastic 拓展配置\n可缺省,不影响项目启动,为了提高生产环境性能,建议按需配置\n1 2 3 4 5 6 7 8 easy-es: keep-alive-millis: 18000 # 心跳策略时间 单位:ms connectTimeout: 5000 # 连接超时时间 单位:ms socketTimeout: 5000 # 通信超时时间 单位:ms requestTimeout: 5000 # 请求超时时间 单位:ms connectionRequestTimeout: 5000 # 连接请求超时时间 单位:ms maxConnTotal: 100 # 最大连接数 单位:个 maxConnPerRoute: 100 # 最大连接路由数 单位:个 全局配置：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 easy-es: banner: false # 默认为true 打印banner 若您不期望打印banner,可配置为false global-config: process_index_mode: smoothly #索引处理模式,smoothly:平滑模式,默认开启此模式, not_smoothly:非平滑模式, manual:手动模式 print-dsl: true # 开启控制台打印通过本框架生成的DSL语句,默认为开启,测试稳定后的生产环境建议关闭,以提升少量性能 distributed: false # 当前项目是否分布式项目,默认为true,在非手动托管索引模式下,若为分布式项目则会获取分布式锁,非分布式项目只需synchronized锁. asyncProcessIndexBlocking: true # 异步处理索引是否阻塞主线程 默认阻塞 数据量过大时调整为非阻塞异步进行 项目启动更快 activeReleaseIndexMaxRetry: 60 # 分布式环境下,平滑模式,当前客户端激活最新索引最大重试次数若数据量过大,重建索引数据迁移时间超过60*(180/60)=180分钟时,可调大此参数值,此参数值决定最大重试次数,超出此次数后仍未成功,则终止重试并记录异常日志 activeReleaseIndexFixedDelay: 180 # 分布式环境下,平滑模式,当前客户端激活最新索引最大重试次数 若数据量过大,重建索引数据迁移时间超过60*(180/60)=180分钟时,可调大此参数值 此参数值决定多久重试一次 单位:秒 db-config: map-underscore-to-camel-case: false # 是否开启下划线转驼峰 默认为false table-prefix: daily_ # 索引前缀,可用于区分环境 默认为空 用法和MP一样 id-type: customize # id生成策略 customize为自定义,id值由用户生成,比如取MySQL中的数据id,如缺省此项配置,则id默认策略为es自动生成 field-strategy: not_empty # 字段更新策略 默认为not_null enable-track-total-hits: true # 默认开启,查询若指定了size超过1w条时也会自动开启,开启后查询所有匹配数据,若不开启,会导致无法获取数据总条数,其它功能不受影响. refresh-policy: immediate # 数据刷新策略,默认为不刷新 enable-must2-filter: false # 是否全局开启must查询类型转换为filter查询类型 默认为false不转换 代码 数据模型（相当于MP的entity） 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 /** * es 数据模型 * **/ @Data @Accessors(chain = true) @IndexName(value = \"es_document\", shardsNum = 3, replicasNum = 2, keepGlobalPrefix = true, maxResultWindow = 100) public class Document { /** * es中的唯一id,如果你想自定义es中的id为你提供的id,比如MySQL中的id,请将注解中的type指定为customize或直接在全局配置文件中指定,如此id便支持任意数据类型) */ @IndexId(type = IdType.CUSTOMIZE) private String id; /** * 文档标题,不指定类型默认被创建为keyword类型,可进行精确查询 */ private String title; /** * 文档内容,指定了类型及存储/查询分词器 */ @HighLight(mappingField = \"highlightContent\") @IndexField(fieldType = FieldType.TEXT, analyzer = Analyzer.IK_SMART) private String content; /** * 作者 加@TableField注解,并指明strategy = FieldStrategy.NOT_EMPTY 表示更新的时候的策略为 创建者不为空字符串时才更新 */ @IndexField(strategy = FieldStrategy.NOT_EMPTY) private String creator; /** * 创建时间 */ @IndexField(fieldType = FieldType.DATE, dateFormat = \"yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis\") private String gmtCreate; /** * es中实际不存在的字段,但模型中加了,为了不和es映射,可以在此类型字段上加上 注解@TableField,并指明exist=false */ @IndexField(exist = false) private String notExistsField; /** * 地理位置经纬度坐标 例如: \"40.13933715136454,116.63441990026217\" */ @IndexField(fieldType = FieldType.GEO_POINT) private String location; /** * 图形(例如圆心,矩形) */ @IndexField(fieldType = FieldType.GEO_SHAPE) private String geoLocation; /** * 自定义字段名称 */ @IndexField(value = \"wu-la\", fieldType = FieldType.TEXT, analyzer = Analyzer.IK_SMART, searchAnalyzer = Analyzer.IK_SMART, fieldData = true) private String customField; /** * 高亮返回值被映射的字段 */ private String highlightContent; /** * 文档点赞数 */ private Integer starNum; } mapper 1 2 3 4 5 6 /** * mapper 相当于Mybatis-plus的mapper * **/ public interface DocumentMapper extends BaseEsMapper\u003cDocument\u003e { } controller 调用接口 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 @RestController @RequestMapping(\"/es\") @Tag(name = \"es案例\") @RequiredArgsConstructor @Slf4j public class EsController { private final DocumentMapper documentMapper; /** * 初始化插入数据,默认开启自动挡,自动挡模式下,索引会自动创建及更新. 若未开启自动挡,则在此步骤前需先调用创建索引API完成索引创建 * * @return */ @Operation(summary = \"添加文档\") @PostMapping(\"insert\") public Integer insert(@RequestBody Document document) { document.setGmtCreate(LocalDateTime.now().format(DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\"))); return documentMapper.insert(document); } @Operation(summary = \"批量添加测试\") @PostMapping(\"batchInsert\") public void testBatchInsert() { List documentList = new ArrayList\u003c\u003e(); for (int i = 2; i \u003c 23; i++) { Document document = new Document(); document.setId(Integer.toString(i)); document.setTitle(\"测试文档\" + i); document.setContent(\"测试内容\" + i); document.setCreator(\"老汉\" + i); document.setGmtCreate(LocalDateTime.now().format(DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\"))); document.setCustomField(\"自定义字段\" + i); Point point = new Point(13.400544 + i, 52.530286 + i); document.setGeoLocation(point.toString()); document.setStarNum(i); if (i == 2) { document.setLocation(\"40.17836693398477,116.64002551005981\"); document.setStarNum(1); } else if (i == 3) { document.setLocation(\"40.19103839805197,116.5624013764374\"); } else if (i == 4) { document.setLocation(\"40.13933715136454,116.63441990026217\"); } documentList.add(document); } int count = documentMapper.insertBatch(documentList); Assert.equals(documentList.size(), count); } /** * 演示根据标题精确查询文章 * 例如title传值为 我真帅,那么在当前配置的索引下,所有标题为'我真帅'的文章都会被查询出来 * 其它各种场景的查询使用,请移步至test模块 * * @param title * @return */ @Operation(summary = \"根据标题精确查询文章\") @GetMapping(\"/listDocumentByTitle\") public List listDocumentByTitle(@RequestParam String title) { // 实际开发中会把这些逻辑写进service层 这里为了演示方便就不创建service层了 LambdaEsQueryWrapper wrapper = new LambdaEsQueryWrapper\u003c\u003e(); wrapper.eq(Document::getTitle, title); return documentMapper.selectList(wrapper); } @Operation(summary = \"查询id是1,2,3的\") @GetMapping(\"/queryConditionIn\") public List testConditionIn() { LambdaEsQueryWrapper wrapper = new LambdaEsQueryWrapper\u003c\u003e(); wrapper.in(Document::getId, \"1\", \"2\", \"3\"); List documents = documentMapper.selectList(wrapper); return documents; } /** * 演示根据title删除文章，同时会被 DeleteInterceptor 拦截，执行逻辑删除 * * @param title * @return */ @Operation(summary = \"根据title删除文章\") @GetMapping(\"/deleteDocumentByTitle\") public Integer deleteDocumentByTitle(@RequestParam String title) { // 实际开发中会把这些逻辑写进service层 这里为了演示方便就不创建service层了 LambdaEsQueryWrapper wrapper = new LambdaEsQueryWrapper\u003c\u003e(); wrapper.eq(Document::getTitle, title); return documentMapper.delete(wrapper); } /** * 自定义注解指定高亮返回字段,高亮查询测试 * * @param content * @return */ @Operation(summary = \"高亮查询测试\") @GetMapping(\"/highlightSearch\") public List highlightSearch(@RequestParam String content) { // 实际开发中会把这些逻辑写进service层 这里为了演示方便就不创建service层了 LambdaEsQueryWrapper wrapper = new LambdaEsQueryWrapper\u003c\u003e(); wrapper.match(Document::getContent, content); return documentMapper.selectList(wrapper); } 注解 启动类添加 1 启动类添加@EsMapperScan(\"com.xxx.mapper\") mapper扫描注解,功能与MP的@MapperScan一致\n@IndexName 索引名注解，标识实体类对应的索引 对应MP的@TableName注解\n@IndexId ES主键注解\n@IndexField ES字段注解\n启动成功，打印：Congratulations auto process index by Easy-Es is don\n具体使用，可以参考代码里面的test工程，工程名：easy-es-test 路径：cn.easyes.test\n不足 ee源码使用的是1.8版本JDK，实际使用过程中，如果项目是Java17（22年，Java19都发布了），会发现不兼容， 目前暂无解决版本，已提issue，给的结论是:目前还不支持jdk 17\n","wordCount":"2948","inLanguage":"en","datePublished":"2022-11-29T00:00:00+08:00","dateModified":"2022-11-29T00:00:00+08:00","author":[{"@type":"Person","name":"藏锋"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://zpc2222.github.io/posts/tech/es%E5%85%A5%E9%97%A8-easy-es/"},"publisher":{"@type":"Organization","name":"我的个人小站","logo":{"@type":"ImageObject","url":"https://zpc2222.github.io/img/Q.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><script async src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><header class=header><nav class=nav><div class=logo><a href=https://zpc2222.github.io accesskey=h title="我的个人小站 (Alt + H)"><img src=https://zpc2222.github.io/img/Q.gif alt=logo aria-label=logo height=35>我的个人小站</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://zpc2222.github.io/search title="🔍 搜索 (Alt + /)" accesskey=/><span>🔍 搜索</span></a></li><li><a href=https://zpc2222.github.io/ title="🏠 主页"><span>🏠 主页</span></a></li><li><a href=https://zpc2222.github.io/posts title="📚 文章"><span>📚 文章</span></a></li><li><a href=https://zpc2222.github.io/tags title="🧩 标签"><span>🧩 标签</span></a></li><li><a href=https://zpc2222.github.io/archives/ title="⏱ 时间轴"><span>⏱ 时间轴</span></a></li><li><a href=https://zpc2222.github.io/music title="🎵 听听歌"><span>🎵 听听歌</span></a></li><li><a href=https://zpc2222.github.io/about title="🙋🏻‍♂️ 关于"><span>🙋🏻‍♂️ 关于</span></a></li><li><a href=https://zpc2222.github.io/links title="🤝 友链"><span>🤝 友链</span></a></li></ul></nav></header><main class="main page"><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://zpc2222.github.io>主页</a>&nbsp;»&nbsp;<a href=https://zpc2222.github.io/posts/>📚文章</a>&nbsp;»&nbsp;<a href=https://zpc2222.github.io/posts/tech/>👨🏻‍💻 技术</a></div><h1 class=post-title>Es入门-easy-es</h1><div class=post-description>ElasticSearch入门使用</div><div class=post-meta>创建:&nbsp;<span title='2022-11-29 00:00:00 +0800 +0800'>2022-11-29</span>&nbsp;|&nbsp;更新:&nbsp;2022-11-29&nbsp;|&nbsp;字数:&nbsp;2948字&nbsp;|&nbsp;时长:&nbsp;6分钟&nbsp;|&nbsp;
作者:&nbsp;藏锋
&nbsp;|&nbsp;标签: &nbsp;<ul class=post-tags-meta><a href=https://zpc2222.github.io/tags/elasticsearch/>ElasticSearch</a>
<a href=https://zpc2222.github.io/tags/java/>、java</a></ul><span id=busuanzi_container_page_pv>&nbsp;| 访问: <span id=busuanzi_value_page_pv></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>文章目录</span></summary><div class=inner><ul><li><a href=#%e7%ae%80%e4%bb%8b aria-label=简介>简介</a></li><li><a href=#%e5%bc%95%e7%94%a8 aria-label=引用>引用</a><ul><li><a href=#pom%e4%be%9d%e8%b5%96 aria-label=pom依赖>pom依赖</a></li><li><a href=#%e9%85%8d%e7%bd%ae aria-label=配置>配置</a></li></ul></li><li><a href=#%e4%bb%a3%e7%a0%81 aria-label=代码>代码</a><ul><li><a href=#%e6%95%b0%e6%8d%ae%e6%a8%a1%e5%9e%8b%e7%9b%b8%e5%bd%93%e4%ba%8emp%e7%9a%84entity aria-label=数据模型（相当于MP的entity）>数据模型（相当于MP的entity）</a></li><li><a href=#mapper aria-label=mapper>mapper</a></li><li><a href=#controller-%e8%b0%83%e7%94%a8%e6%8e%a5%e5%8f%a3 aria-label="controller 调用接口">controller 调用接口</a></li><li><a href=#%e6%b3%a8%e8%a7%a3 aria-label=注解>注解</a></li></ul></li><li><a href=#%e4%b8%8d%e8%b6%b3 aria-label=不足>不足</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=简介>简介<a hidden class=anchor aria-hidden=true href=#简介>#</a></h2><p>官网地址：> <a href=https://www.easy-es.cn>https://www.easy-es.cn</a></p><p>选择理由：省心，省力，省代码。简单好用，少操心</p><h2 id=引用>引用<a hidden class=anchor aria-hidden=true href=#引用>#</a></h2><h3 id=pom依赖>pom依赖<a hidden class=anchor aria-hidden=true href=#pom依赖>#</a></h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>cn.easy-es<span style=color:#f92672>&lt;/groupId&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>easy-es-boot-starter<span style=color:#f92672>&lt;/artifactId&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>1.1.0<span style=color:#f92672>&lt;/version&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!--ES的相关依赖版本需要统一下,建议与服务端版本统一--&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.elasticsearch.client<span style=color:#f92672>&lt;/groupId&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>elasticsearch-rest-high-level-client<span style=color:#f92672>&lt;/artifactId&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>7.14.0<span style=color:#f92672>&lt;/version&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.elasticsearch<span style=color:#f92672>&lt;/groupId&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>elasticsearch<span style=color:#f92672>&lt;/artifactId&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>7.14.0<span style=color:#f92672>&lt;/version&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=配置>配置<a hidden class=anchor aria-hidden=true href=#配置>#</a></h3><p>如果是properties，也差距不大</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>easy-es</span>:  
</span></span><span style=display:flex><span>  <span style=color:#75715e># 是否开启EE自动配置,若为false时,则认为不启用本框架 </span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>enable</span>: <span style=color:#66d9ef>true</span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># ES连接地址+端口  </span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>address</span>:  <span style=color:#ae81ff>127.0.0.1</span>:<span style=color:#ae81ff>9200</span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e># 关闭自带banner  </span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>banner</span>: <span style=color:#66d9ef>false</span>  
</span></span><span style=display:flex><span>  <span style=color:#f92672>schema</span>: <span style=color:#ae81ff>http  </span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>username</span>: <span style=color:#ae81ff>elastic  </span> <span style=color:#75715e>#有设置才填写,非必须</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>password</span>: <span style=color:#ae81ff>elastic</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>拓展配置</strong></p><p>可缺省,不影响项目启动,为了提高生产环境性能,建议按需配置</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>easy-es</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>keep-alive-millis</span>: <span style=color:#ae81ff>18000</span> <span style=color:#75715e># 心跳策略时间 单位:ms</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>connectTimeout</span>: <span style=color:#ae81ff>5000</span> <span style=color:#75715e># 连接超时时间 单位:ms</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>socketTimeout</span>: <span style=color:#ae81ff>5000</span> <span style=color:#75715e># 通信超时时间 单位:ms </span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>requestTimeout</span>: <span style=color:#ae81ff>5000</span> <span style=color:#75715e># 请求超时时间 单位:ms</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>connectionRequestTimeout</span>: <span style=color:#ae81ff>5000</span> <span style=color:#75715e># 连接请求超时时间 单位:ms</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>maxConnTotal</span>: <span style=color:#ae81ff>100</span> <span style=color:#75715e># 最大连接数 单位:个</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>maxConnPerRoute</span>: <span style=color:#ae81ff>100</span> <span style=color:#75715e># 最大连接路由数 单位:个</span>
</span></span></code></pre></td></tr></table></div></div><p>全局配置：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>easy-es</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>banner</span>: <span style=color:#66d9ef>false</span> <span style=color:#75715e># 默认为true 打印banner 若您不期望打印banner,可配置为false</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>global-config</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>process_index_mode</span>: <span style=color:#ae81ff>smoothly</span> <span style=color:#75715e>#索引处理模式,smoothly:平滑模式,默认开启此模式, not_smoothly:非平滑模式, manual:手动模式</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>print-dsl</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># 开启控制台打印通过本框架生成的DSL语句,默认为开启,测试稳定后的生产环境建议关闭,以提升少量性能</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>distributed</span>: <span style=color:#66d9ef>false</span> <span style=color:#75715e># 当前项目是否分布式项目,默认为true,在非手动托管索引模式下,若为分布式项目则会获取分布式锁,非分布式项目只需synchronized锁.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>asyncProcessIndexBlocking</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># 异步处理索引是否阻塞主线程 默认阻塞 数据量过大时调整为非阻塞异步进行 项目启动更快</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>activeReleaseIndexMaxRetry</span>: <span style=color:#ae81ff>60</span> <span style=color:#75715e># 分布式环境下,平滑模式,当前客户端激活最新索引最大重试次数若数据量过大,重建索引数据迁移时间超过60*(180/60)=180分钟时,可调大此参数值,此参数值决定最大重试次数,超出此次数后仍未成功,则终止重试并记录异常日志</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>activeReleaseIndexFixedDelay</span>: <span style=color:#ae81ff>180</span> <span style=color:#75715e># 分布式环境下,平滑模式,当前客户端激活最新索引最大重试次数 若数据量过大,重建索引数据迁移时间超过60*(180/60)=180分钟时,可调大此参数值 此参数值决定多久重试一次 单位:秒</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#f92672>db-config</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>map-underscore-to-camel-case</span>: <span style=color:#66d9ef>false</span> <span style=color:#75715e># 是否开启下划线转驼峰 默认为false</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>table-prefix</span>: <span style=color:#ae81ff>daily_</span> <span style=color:#75715e># 索引前缀,可用于区分环境  默认为空 用法和MP一样</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>id-type</span>: <span style=color:#ae81ff>customize</span> <span style=color:#75715e># id生成策略 customize为自定义,id值由用户生成,比如取MySQL中的数据id,如缺省此项配置,则id默认策略为es自动生成</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>field-strategy</span>: <span style=color:#ae81ff>not_empty</span> <span style=color:#75715e># 字段更新策略 默认为not_null</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>enable-track-total-hits</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># 默认开启,查询若指定了size超过1w条时也会自动开启,开启后查询所有匹配数据,若不开启,会导致无法获取数据总条数,其它功能不受影响.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>refresh-policy</span>: <span style=color:#ae81ff>immediate</span> <span style=color:#75715e># 数据刷新策略,默认为不刷新</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>enable-must2-filter</span>: <span style=color:#66d9ef>false</span> <span style=color:#75715e># 是否全局开启must查询类型转换为filter查询类型 默认为false不转换</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=代码>代码<a hidden class=anchor aria-hidden=true href=#代码>#</a></h2><h3 id=数据模型相当于mp的entity>数据模型（相当于MP的entity）<a hidden class=anchor aria-hidden=true href=#数据模型相当于mp的entity>#</a></h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e> * es 数据模型  
</span></span></span><span style=display:flex><span><span style=color:#75715e> * &lt;p&gt;  
</span></span></span><span style=display:flex><span><span style=color:#75715e> **/</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Accessors</span><span style=color:#f92672>(</span>chain <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span><span style=color:#a6e22e>@IndexName</span><span style=color:#f92672>(</span>value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;es_document&#34;</span><span style=color:#f92672>,</span> shardsNum <span style=color:#f92672>=</span> 3<span style=color:#f92672>,</span> replicasNum <span style=color:#f92672>=</span> 2<span style=color:#f92672>,</span> keepGlobalPrefix <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>,</span> maxResultWindow <span style=color:#f92672>=</span> 100<span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Document</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * es中的唯一id,如果你想自定义es中的id为你提供的id,比如MySQL中的id,请将注解中的type指定为customize或直接在全局配置文件中指定,如此id便支持任意数据类型)  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>    <span style=color:#a6e22e>@IndexId</span><span style=color:#f92672>(</span>type <span style=color:#f92672>=</span> IdType<span style=color:#f92672>.</span><span style=color:#a6e22e>CUSTOMIZE</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String id<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 文档标题,不指定类型默认被创建为keyword类型,可进行精确查询  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String title<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 文档内容,指定了类型及存储/查询分词器  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@HighLight</span><span style=color:#f92672>(</span>mappingField <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;highlightContent&#34;</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@IndexField</span><span style=color:#f92672>(</span>fieldType <span style=color:#f92672>=</span> FieldType<span style=color:#f92672>.</span><span style=color:#a6e22e>TEXT</span><span style=color:#f92672>,</span> analyzer <span style=color:#f92672>=</span> Analyzer<span style=color:#f92672>.</span><span style=color:#a6e22e>IK_SMART</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String content<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 作者 加@TableField注解,并指明strategy = FieldStrategy.NOT_EMPTY 表示更新的时候的策略为 创建者不为空字符串时才更新  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@IndexField</span><span style=color:#f92672>(</span>strategy <span style=color:#f92672>=</span> FieldStrategy<span style=color:#f92672>.</span><span style=color:#a6e22e>NOT_EMPTY</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String creator<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 创建时间  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@IndexField</span><span style=color:#f92672>(</span>fieldType <span style=color:#f92672>=</span> FieldType<span style=color:#f92672>.</span><span style=color:#a6e22e>DATE</span><span style=color:#f92672>,</span> dateFormat <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis&#34;</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String gmtCreate<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * es中实际不存在的字段,但模型中加了,为了不和es映射,可以在此类型字段上加上 注解@TableField,并指明exist=false  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>    <span style=color:#a6e22e>@IndexField</span><span style=color:#f92672>(</span>exist <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String notExistsField<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 地理位置经纬度坐标 例如: &#34;40.13933715136454,116.63441990026217&#34;  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>    <span style=color:#a6e22e>@IndexField</span><span style=color:#f92672>(</span>fieldType <span style=color:#f92672>=</span> FieldType<span style=color:#f92672>.</span><span style=color:#a6e22e>GEO_POINT</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String location<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 图形(例如圆心,矩形)  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>    <span style=color:#a6e22e>@IndexField</span><span style=color:#f92672>(</span>fieldType <span style=color:#f92672>=</span> FieldType<span style=color:#f92672>.</span><span style=color:#a6e22e>GEO_SHAPE</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String geoLocation<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 自定义字段名称  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@IndexField</span><span style=color:#f92672>(</span>value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;wu-la&#34;</span><span style=color:#f92672>,</span> fieldType <span style=color:#f92672>=</span> FieldType<span style=color:#f92672>.</span><span style=color:#a6e22e>TEXT</span><span style=color:#f92672>,</span> analyzer <span style=color:#f92672>=</span> Analyzer<span style=color:#f92672>.</span><span style=color:#a6e22e>IK_SMART</span><span style=color:#f92672>,</span> searchAnalyzer <span style=color:#f92672>=</span> Analyzer<span style=color:#f92672>.</span><span style=color:#a6e22e>IK_SMART</span><span style=color:#f92672>,</span> fieldData <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>)</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String customField<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 高亮返回值被映射的字段  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String highlightContent<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 文档点赞数  
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>  
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer starNum<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=mapper>mapper<a hidden class=anchor aria-hidden=true href=#mapper>#</a></h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>/**  
</span></span></span><span style=display:flex><span><span style=color:#75715e> * mapper 相当于Mybatis-plus的mapper  
</span></span></span><span style=display:flex><span><span style=color:#75715e> * &lt;p&gt;  
</span></span></span><span style=display:flex><span><span style=color:#75715e> **/</span>  
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>DocumentMapper</span> <span style=color:#66d9ef>extends</span> BaseEsMapper<span style=color:#f92672>&lt;</span>Document<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=controller-调用接口>controller 调用接口<a hidden class=anchor aria-hidden=true href=#controller-调用接口>#</a></h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>@RestController  
</span></span><span style=display:flex><span>@RequestMapping(&#34;/es&#34;)  
</span></span><span style=display:flex><span>@Tag(name = &#34;es案例&#34;)  
</span></span><span style=display:flex><span>@RequiredArgsConstructor  
</span></span><span style=display:flex><span>@Slf4j  
</span></span><span style=display:flex><span>public class EsController {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    private final DocumentMapper documentMapper;  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    /**  
</span></span><span style=display:flex><span>     * 初始化插入数据,默认开启自动挡,自动挡模式下,索引会自动创建及更新. 若未开启自动挡,则在此步骤前需先调用创建索引API完成索引创建  
</span></span><span style=display:flex><span>     *  
</span></span><span style=display:flex><span>     * @return  
</span></span><span style=display:flex><span>     */  
</span></span><span style=display:flex><span>    @Operation(summary = &#34;添加文档&#34;)  
</span></span><span style=display:flex><span>    @PostMapping(&#34;insert&#34;)  
</span></span><span style=display:flex><span>    public Integer insert(@RequestBody Document document) {  
</span></span><span style=display:flex><span>        document.setGmtCreate(LocalDateTime.now().format(DateTimeFormatter.ofPattern(&#34;yyyy-MM-dd HH:mm:ss&#34;)));  
</span></span><span style=display:flex><span>        return documentMapper.insert(document);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    @Operation(summary = &#34;批量添加测试&#34;)  
</span></span><span style=display:flex><span>    @PostMapping(&#34;batchInsert&#34;)  
</span></span><span style=display:flex><span>    public void testBatchInsert() {  
</span></span><span style=display:flex><span>        List&lt;Document&gt; documentList = new ArrayList&lt;&gt;();  
</span></span><span style=display:flex><span>        for (int i = 2; i &lt; 23; i++) {  
</span></span><span style=display:flex><span>            Document document = new Document();  
</span></span><span style=display:flex><span>            document.setId(Integer.toString(i));  
</span></span><span style=display:flex><span>            document.setTitle(&#34;测试文档&#34; + i);  
</span></span><span style=display:flex><span>            document.setContent(&#34;测试内容&#34; + i);  
</span></span><span style=display:flex><span>            document.setCreator(&#34;老汉&#34; + i);  
</span></span><span style=display:flex><span>            document.setGmtCreate(LocalDateTime.now().format(DateTimeFormatter.ofPattern(&#34;yyyy-MM-dd HH:mm:ss&#34;)));  
</span></span><span style=display:flex><span>            document.setCustomField(&#34;自定义字段&#34; + i);  
</span></span><span style=display:flex><span>            Point point = new Point(13.400544 + i, 52.530286 + i);  
</span></span><span style=display:flex><span>            document.setGeoLocation(point.toString());  
</span></span><span style=display:flex><span>            document.setStarNum(i);  
</span></span><span style=display:flex><span>            if (i == 2) {  
</span></span><span style=display:flex><span>                document.setLocation(&#34;40.17836693398477,116.64002551005981&#34;);  
</span></span><span style=display:flex><span>                document.setStarNum(1);  
</span></span><span style=display:flex><span>            } else if (i == 3) {  
</span></span><span style=display:flex><span>                document.setLocation(&#34;40.19103839805197,116.5624013764374&#34;);  
</span></span><span style=display:flex><span>            } else if (i == 4) {  
</span></span><span style=display:flex><span>                document.setLocation(&#34;40.13933715136454,116.63441990026217&#34;);  
</span></span><span style=display:flex><span>            }  
</span></span><span style=display:flex><span>            documentList.add(document);  
</span></span><span style=display:flex><span>        }  
</span></span><span style=display:flex><span>        int count = documentMapper.insertBatch(documentList);  
</span></span><span style=display:flex><span>        Assert.equals(documentList.size(), count);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    /**  
</span></span><span style=display:flex><span>     * 演示根据标题精确查询文章  
</span></span><span style=display:flex><span>     * 例如title传值为 我真帅,那么在当前配置的索引下,所有标题为&#39;我真帅&#39;的文章都会被查询出来  
</span></span><span style=display:flex><span>     * 其它各种场景的查询使用,请移步至test模块  
</span></span><span style=display:flex><span>     *  
</span></span><span style=display:flex><span>     * @param title  
</span></span><span style=display:flex><span>     * @return  
</span></span><span style=display:flex><span>     */  
</span></span><span style=display:flex><span>    @Operation(summary = &#34;根据标题精确查询文章&#34;)  
</span></span><span style=display:flex><span>    @GetMapping(&#34;/listDocumentByTitle&#34;)  
</span></span><span style=display:flex><span>    public List&lt;Document&gt; listDocumentByTitle(@RequestParam String title) {  
</span></span><span style=display:flex><span>        // 实际开发中会把这些逻辑写进service层 这里为了演示方便就不创建service层了  
</span></span><span style=display:flex><span>        LambdaEsQueryWrapper&lt;Document&gt; wrapper = new LambdaEsQueryWrapper&lt;&gt;();  
</span></span><span style=display:flex><span>        wrapper.eq(Document::getTitle, title);  
</span></span><span style=display:flex><span>        return documentMapper.selectList(wrapper);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    @Operation(summary = &#34;查询id是1,2,3的&#34;)  
</span></span><span style=display:flex><span>    @GetMapping(&#34;/queryConditionIn&#34;)  
</span></span><span style=display:flex><span>    public List&lt;Document&gt; testConditionIn() {  
</span></span><span style=display:flex><span>        LambdaEsQueryWrapper&lt;Document&gt; wrapper = new LambdaEsQueryWrapper&lt;&gt;();  
</span></span><span style=display:flex><span>        wrapper.in(Document::getId, &#34;1&#34;, &#34;2&#34;, &#34;3&#34;);  
</span></span><span style=display:flex><span>        List&lt;Document&gt; documents = documentMapper.selectList(wrapper);  
</span></span><span style=display:flex><span>        return documents;  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    /**  
</span></span><span style=display:flex><span>     * 演示根据title删除文章，同时会被 DeleteInterceptor 拦截，执行逻辑删除  
</span></span><span style=display:flex><span>     *  
</span></span><span style=display:flex><span>     * @param title  
</span></span><span style=display:flex><span>     * @return  
</span></span><span style=display:flex><span>     */  
</span></span><span style=display:flex><span>    @Operation(summary = &#34;根据title删除文章&#34;)  
</span></span><span style=display:flex><span>    @GetMapping(&#34;/deleteDocumentByTitle&#34;)  
</span></span><span style=display:flex><span>    public Integer deleteDocumentByTitle(@RequestParam String title) {  
</span></span><span style=display:flex><span>        // 实际开发中会把这些逻辑写进service层 这里为了演示方便就不创建service层了  
</span></span><span style=display:flex><span>        LambdaEsQueryWrapper&lt;Document&gt; wrapper = new LambdaEsQueryWrapper&lt;&gt;();  
</span></span><span style=display:flex><span>        wrapper.eq(Document::getTitle, title);  
</span></span><span style=display:flex><span>        return documentMapper.delete(wrapper);  
</span></span><span style=display:flex><span>    }  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    /**  
</span></span><span style=display:flex><span>     * 自定义注解指定高亮返回字段,高亮查询测试  
</span></span><span style=display:flex><span>     *  
</span></span><span style=display:flex><span>     * @param content  
</span></span><span style=display:flex><span>     * @return  
</span></span><span style=display:flex><span>     */  
</span></span><span style=display:flex><span>    @Operation(summary = &#34;高亮查询测试&#34;)  
</span></span><span style=display:flex><span>    @GetMapping(&#34;/highlightSearch&#34;)  
</span></span><span style=display:flex><span>    public List&lt;Document&gt; highlightSearch(@RequestParam String content) {  
</span></span><span style=display:flex><span>        // 实际开发中会把这些逻辑写进service层 这里为了演示方便就不创建service层了  
</span></span><span style=display:flex><span>        LambdaEsQueryWrapper&lt;Document&gt; wrapper = new LambdaEsQueryWrapper&lt;&gt;();  
</span></span><span style=display:flex><span>        wrapper.match(Document::getContent, content);  
</span></span><span style=display:flex><span>        return documentMapper.selectList(wrapper);  
</span></span><span style=display:flex><span>    }
</span></span></code></pre></td></tr></table></div></div><h3 id=注解>注解<a hidden class=anchor aria-hidden=true href=#注解>#</a></h3><ol><li>启动类添加</li></ol><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>启动类添加@EsMapperScan(&#34;com.xxx.mapper&#34;)
</span></span></code></pre></td></tr></table></div></div><p>mapper扫描注解,功能与MP的@MapperScan一致</p><ol start=2><li><p>@IndexName 索引名注解，标识实体类对应的索引 对应MP的@TableName注解</p></li><li><p>@IndexId ES主键注解</p></li><li><p>@IndexField ES字段注解</p></li></ol><p>启动成功，打印：Congratulations auto process index by Easy-Es is don</p><p>具体使用，可以参考代码里面的test工程，工程名：easy-es-test 路径：cn.easyes.test</p><h2 id=不足>不足<a hidden class=anchor aria-hidden=true href=#不足>#</a></h2><p>ee源码使用的是1.8版本JDK，实际使用过程中，如果项目是Java17（22年，Java19都发布了），会发现不兼容，
目前暂无解决版本，已提issue，给的结论是:目前还不支持jdk 17</p></div><div style="padding:10px 0;margin:20px auto;width:100%;font-size:16px;text-align:center">☕ 请我喝杯咖啡吧 ヾ(^▽^*)))
<button id=rewardButton disable=enable onclick='var qr=document.getElementById("QR");qr.style.display==="none"?qr.style.display="block":qr.style.display="none"'>
<span>打赏</span></button><div id=QR style=display:none><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://zpc2222.github.io/img/wechat-pay.jpg alt="WeChat Pay" style=width:280px;height:280px></a><p>微信</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://zpc2222.github.io/img/ali-pay.jpg alt=Alipay style=width:280px;height:280px></a><p>支付宝</p></div></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://zpc2222.github.io/posts/life/web-plugin/><span class=title>« 上一页</span><br><span>网页插件</span></a>
<a class=next href=https://zpc2222.github.io/posts/tech/java/java-common/><span class=title>下一页 »</span><br><span>Java常用速记</span></a></nav></footer></div><div><div class=pagination__title><span class=pagination__title-h style=font-size:20px>💬评论</span><hr></div><div id=tcomment></div><script src=https://cdn.staticfile.org/twikoo/1.6.7/twikoo.all.min.js></script><script>twikoo.init({envId:"https://vercel-zpc2222.vercel.app",el:"#tcomment",lang:"zh-CN",region:null,path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><script async src=https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js></script>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><footer class=footer><span>Copyright
&copy;
2022-2023
<a href=https://zpc2222.github.io style=color:#939393>我的个人小站</a>
All Rights Reserved</span>
<span id=busuanzi_container><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css>总访客数: <i class="fa fa-user"></i><span id=busuanzi_value_site_uv></span>
总访问量: <i class="fa fa-eye"></i><span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>400||document.documentElement.scrollTop>400?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`

————————————————
版权声明：本文为「我的个人小站」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href,s=window.getSelection().toString()+`

————————————————
版权声明：本文为「我的个人小站」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="📄复制";function s(){t.innerText="👌🏻已复制!",setTimeout(()=>{t.innerText="📄复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`
————————————————
版权声明：本文为「我的个人小站」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href;navigator.clipboard.writeText(t),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>